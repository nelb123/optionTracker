<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Options Edge Tracker (Local)</title>
  <style>
    :root{
      --bg:#0b1220;
      --card:#0f1a2e;
      --muted:#93a4c7;
      --text:#e8efff;
      --line:#1c2b4a;
      --good:#35d07f;
      --bad:#ff5b6e;
      --warn:#ffd166;
      --accent:#5aa7ff;
      --shadow: 0 10px 30px rgba(0,0,0,.35);
      --radius: 14px;
      --mono: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono", "Courier New", monospace;
      --sans: ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial, "Apple Color Emoji","Segoe UI Emoji";
    }
    *{box-sizing:border-box}
    body{
      margin:0;
      font-family:var(--sans);
      background: radial-gradient(1200px 700px at 20% 10%, #14254a 0%, rgba(20,37,74,0) 60%),
                  radial-gradient(900px 600px at 90% 0%, #1a3a64 0%, rgba(26,58,100,0) 55%),
                  var(--bg);
      color:var(--text);
      min-height:100vh;
    }
    header{
      padding:22px 18px 10px;
      max-width:1150px;
      margin:0 auto;
      display:flex;
      justify-content:space-between;
      align-items:center;
      gap:12px;
    }
    .brand{
      display:flex; align-items:center; gap:10px;
    }
    .logo{
      width:38px;height:38px;border-radius:12px;
      background: linear-gradient(135deg, #5aa7ff, #9b5cff);
      box-shadow: var(--shadow);
    }
    h1{margin:0; font-size:18px; letter-spacing:.2px}
    .sub{color:var(--muted); font-size:13px; margin-top:2px}
    .top-actions{
      display:flex; gap:10px; flex-wrap:wrap; justify-content:flex-end;
    }
    button{
      background:transparent;
      color:var(--text);
      border:1px solid var(--line);
      padding:10px 12px;
      border-radius:12px;
      cursor:pointer;
      transition: .15s ease;
      font-weight:600;
    }
    button:hover{border-color:#2b4270; transform: translateY(-1px);}
    button.primary{
      background: linear-gradient(135deg, #2b89ff, #7a5cff);
      border:0;
      box-shadow: var(--shadow);
    }
    button.danger{border-color:rgba(255,91,110,.6); color:#ffd1d7;}
    button.danger:hover{border-color:rgba(255,91,110,.9);}

    main{
      max-width:1150px;
      margin:0 auto;
      padding:10px 18px 40px;
      display:grid;
      grid-template-columns: 1.1fr .9fr;
      gap:14px;
    }
    @media (max-width: 980px){
      main{grid-template-columns:1fr}
    }

    .card{
      background: rgba(15,26,46,.92);
      border:1px solid var(--line);
      border-radius: var(--radius);
      box-shadow: var(--shadow);
      overflow:hidden;
    }
    .card .hd{
      padding:14px 14px 10px;
      border-bottom:1px solid var(--line);
      display:flex;
      align-items:flex-end;
      justify-content:space-between;
      gap:12px;
    }
    .card .hd h2{margin:0; font-size:14px; letter-spacing:.2px}
    .card .hd .hint{color:var(--muted); font-size:12px}
    .card .bd{padding:14px}

    .grid{
      display:grid;
      grid-template-columns: repeat(4, 1fr);
      gap:10px;
    }
    @media (max-width: 980px){
      .grid{grid-template-columns: repeat(2, 1fr)}
    }

    .stat{
      padding:12px;
      border-radius:14px;
      border:1px solid var(--line);
      background: rgba(11,18,32,.5);
    }
    .stat .k{color:var(--muted); font-size:12px}
    .stat .v{font-size:18px; font-weight:800; margin-top:6px; font-family:var(--mono)}

    .pill{
      display:inline-flex; align-items:center; gap:8px;
      padding:8px 10px;
      border-radius:999px;
      border:1px solid var(--line);
      background: rgba(11,18,32,.45);
      color:var(--muted);
      font-size:12px;
      white-space:nowrap;
    }
    .dot{width:8px;height:8px;border-radius:50%;}
    .dot.good{background:var(--good)}
    .dot.bad{background:var(--bad)}
    .dot.warn{background:var(--warn)}

    form{
      display:grid;
      grid-template-columns: 1fr 1fr;
      gap:10px;
    }
    @media (max-width: 560px){
      form{grid-template-columns:1fr}
    }

    label{display:block; font-size:12px; color:var(--muted); margin-bottom:6px}
    input, select, textarea{
      width:100%;
      padding:10px 10px;
      border-radius:12px;
      border:1px solid var(--line);
      background: rgba(11,18,32,.65);
      color:var(--text);
      outline:none;
    }
    input::placeholder, textarea::placeholder{color:#6f84b3}
    textarea{min-height:90px; resize:vertical}

    .row-actions{
      grid-column: 1 / -1;
      display:flex;
      gap:10px;
      align-items:center;
      flex-wrap:wrap;
      margin-top:2px;
    }
    .row-actions .spacer{flex:1}
    .note{font-size:12px; color:var(--muted);}

    .toolbar{
      display:flex;
      gap:10px;
      align-items:center;
      flex-wrap:wrap;
    }
    .toolbar input{max-width:260px}

    /* --- Table --- */
    #tableWrap{
      overflow-x:auto;
      -webkit-overflow-scrolling: touch;
    }

    table{
      width:100%;
      border-collapse:separate;
      border-spacing:0;
      overflow:hidden;
      border-radius: 14px;
      border:1px solid var(--line);
      min-width: 1100px; /* forces scroll when many columns */
    }

    thead th{
      text-align:left;
      font-size:12px;
      color:var(--muted);
      padding:10px 10px;
      background: rgba(11,18,32,.65);
      border-bottom:1px solid var(--line);

      position: sticky;
      top: 0;
      z-index: 4;
    }

    tbody td{
      padding:10px 10px;
      border-bottom:1px solid rgba(28,43,74,.7);
      font-size:13px;
      vertical-align:top;
    }
    tbody tr:last-child td{border-bottom:0}

    .tag{
      font-family:var(--mono);
      font-size:12px;
      padding:4px 8px;
      border-radius:999px;
      border:1px solid var(--line);
      background: rgba(11,18,32,.45);
      display:inline-block;
    }

    .result.good{color:var(--good); font-weight:800}
    .result.bad{color:var(--bad); font-weight:800}
    .result.warn{color:var(--warn); font-weight:800}

    .small{font-size:12px; color:var(--muted)}

    /* Sticky last column so Delete is always visible */
    th:last-child,
    td:last-child{
      position: sticky;
      right: 0;
      background: rgba(11,18,32,.95);
      z-index: 3;
      border-left: 1px solid rgba(28,43,74,.7);
      white-space: nowrap;
    }

    /* Compact delete button */
    .btn-del{
      padding: 8px 10px;
      border-radius: 10px;
      border: 1px solid rgba(255,91,110,.7);
      background: rgba(255,91,110,.08);
      color: #ffd1d7;
      font-weight: 900;
      line-height: 1;
      cursor:pointer;
    }
    .btn-del:hover{
      border-color: rgba(255,91,110,1);
      transform: translateY(-1px);
    }

    .right-col{
      display:flex;
      flex-direction:column;
      gap:14px;
    }

    .split{
      display:grid;
      grid-template-columns: 1fr 1fr;
      gap:10px;
    }

    .list{
      display:flex; flex-direction:column; gap:8px;
    }

    .item{
      display:flex; justify-content:space-between; gap:10px;
      padding:10px;
      border:1px solid var(--line);
      border-radius:14px;
      background: rgba(11,18,32,.5);
    }
    .item .left{display:flex; flex-direction:column; gap:2px}
    .item .title{font-weight:800; font-family:var(--mono)}
    .item .meta{font-size:12px; color:var(--muted)}
    .item .val{font-weight:900; font-family:var(--mono)}

    .empty{
      padding:14px;
      border:1px dashed rgba(147,164,199,.35);
      border-radius:14px;
      color:var(--muted);
      font-size:13px;
      background: rgba(11,18,32,.35);
    s

    .footer{
      max-width:1150px; margin:0 auto;
      padding:0 18px 24px;
      color:var(--muted);
      font-size:12px;
    }

    a{color:#9ec7ff; text-decoration:none}
    a:hover{text-decoration:underline}
  </style>
</head>
<body>
  <header>
    <div class="brand">
      <div class="logo" aria-hidden="true"></div>
      <div>
        <h1>Options Edge Tracker <span class="small"></span></h1>
        <div class="sub">Log selling-option trades • See win rate • Track your edge</div>
      </div>
    </div>

    <div class="top-actions">
      <button id="btnExport">Export CSV</button>
      <button class="danger" id="btnClear">Clear All</button>
      <button class="primary" id="btnAddSample">Add Sample Trades</button>
    </div>
  </header>

  <main>
    <!-- LEFT: Dashboard + Table -->
    <section class="card">
      <div class="hd">
        <div>
          <h2>Dashboard</h2>
          <div class="hint">Win rate + quick performance stats (manual entry)</div>
        </div>
        <div class="toolbar">
          <span class="pill"><span class="dot good"></span> Win</span>
          <span class="pill"><span class="dot warn"></span> Breakeven</span>
          <span class="pill"><span class="dot bad"></span> Loss</span>
          <input id="search" type="text" placeholder="Search (ticker/strategy/note)"/>
        </div>
      </div>

      <div class="bd">
        <div class="grid" id="statsGrid">
          <!-- stats injected -->
        </div>

        <div style="height:12px"></div>

        <div class="card" style="background:transparent; border:none; box-shadow:none">
          <div class="hd" style="padding:0 0 10px; border:0">
            <h2>Trades</h2>
            <div class="hint">Click “✕” to delete a row</div>
          </div>
          <div class="bd" style="padding:0">
            <div id="tableWrap"></div>
          </div>
        </div>
      </div>
    </section>

    <!-- RIGHT: Add Trade + Breakdown -->
    <div class="right-col">
      <section class="card">
        <div class="hd">
          <div>
            <h2>Add Trade</h2>
            <div class="hint">Keep it fast — under 30 seconds</div>
          </div>
        </div>

        <div class="bd">
          <form id="tradeForm">
            <div>
              <label>Ticker</label>
              <input id="ticker" placeholder="e.g., SPY, TSLA, NVDA" required />
            </div>

            <div>
              <label>Strategy</label>
              <select id="strategy" required>
                <option value="CSP">Cash-Secured Put (CSP)</option>
                <option value="CC">Covered Call (CC)</option>
                <option value="Credit Spread">Credit Spread</option>
                <option value="Iron Condor">Iron Condor</option>
                <option value="Other">Other</option>
              </select>
            </div>

            <div>
              <label>Entry Date</label>
              <input id="entryDate" type="date" required />
            </div>

            <div>
              <label>Expiration</label>
              <input id="expDate" type="date" required />
            </div>

            <div>
              <label>Strike(s)</label>
              <input id="strikes" placeholder="e.g., 420p or 450/455" />
            </div>

            <div>
              <label>Result</label>
              <select id="result" required>
                <option value="Win">Win</option>
                <option value="Breakeven">Breakeven</option>
                <option value="Loss">Loss</option>
              </select>
            </div>

            <div>
              <label>Credit Received ($)</label>
              <input id="credit" type="number" step="0.01" placeholder="e.g., 85.00" />
            </div>

            <div>
              <label>P/L ($)</label>
              <input id="pl" type="number" step="0.01" placeholder="e.g., 62.50 or -120.00" />
            </div>

            <div>
              <label>IV Rank (optional)</label>
              <input id="ivr" type="number" step="1" min="0" max="100" placeholder="0-100" />
            </div>

            <div>
              <label>Tags (optional)</label>
              <input id="tags" placeholder="e.g., earnings, highIV, weekly" />
            </div>

            <div style="grid-column:1/-1">
              <label>Notes</label>
              <textarea id="notes" placeholder="Why did you take this? Any rule violations?"></textarea>
            </div>

            <div class="row-actions">
              <button class="primary" type="submit">Save Trade</button>
              <button type="button" id="btnReset">Reset</button>
              <span class="spacer"></span>
              <span class="note">Data saves to your browser (localStorage).</span>
            </div>
          </form>
        </div>
      </section>

      <section class="card">
        <div class="hd">
          <div>
            <h2>Breakdown</h2>
            <div class="hint">Your edge by strategy + ticker</div>
          </div>
        </div>
        <div class="bd">
          <div class="split">
            <div>
              <div class="small" style="margin:0 0 8px">By Strategy (Win Rate)</div>
              <div class="list" id="byStrategy"></div>
            </div>
            <div>
              <div class="small" style="margin:0 0 8px">Top Tickers (Win Rate)</div>
              <div class="list" id="byTicker"></div>
            </div>
          </div>
          <div style="height:12px"></div>
          <div class="small">
            Tip: If a ticker has a low win rate, you either need tighter filters or stop trading it.
          </div>
        </div>
      </section>
    </div>
  </main>

<script>
  // ---------------------------
  // Local Storage + Utilities
  // ---------------------------
  const STORAGE_KEY = "options_edge_tracker_trades_v1";

  function loadTrades(){
    try{
      return JSON.parse(localStorage.getItem(STORAGE_KEY) || "[]");
    }catch{
      return [];
    }
  }
  function saveTrades(trades){
    localStorage.setItem(STORAGE_KEY, JSON.stringify(trades));
  }
  function uid(){
    return Math.random().toString(16).slice(2) + Date.now().toString(16);
  }
  function fmtPct(n){
    if (!isFinite(n)) return "—";
    return (n * 100).toFixed(1) + "%";
  }
  function fmtNum(n){
    if (n === null || n === undefined || n === "" || !isFinite(n)) return "—";
    return Number(n).toFixed(2);
  }
  function safeUpper(s){ return (s||"").toString().trim().toUpperCase(); }
  function normalizeTags(s){
    return (s||"")
      .split(",")
      .map(t => t.trim())
      .filter(Boolean);
  }

  // ---------------------------
  // Stats + Breakdown
  // ---------------------------
  function computeStats(trades){
    const total = trades.length;
    const wins = trades.filter(t => t.result === "Win").length;
    const losses = trades.filter(t => t.result === "Loss").length;
    const breakevens = trades.filter(t => t.result === "Breakeven").length;

    const winRate = total ? wins / total : NaN;

    const plVals = trades
      .map(t => Number(t.pl))
      .filter(v => isFinite(v));

    const totalPL = plVals.reduce((a,b)=>a+b,0);
    const avgPL = plVals.length ? totalPL / plVals.length : NaN;

    const avgCreditVals = trades
      .map(t => Number(t.credit))
      .filter(v => isFinite(v));
    const avgCredit = avgCreditVals.length ? (avgCreditVals.reduce((a,b)=>a+b,0) / avgCreditVals.length) : NaN;

    // Profit factor: sum(profits) / abs(sum(losses))
    const profits = plVals.filter(v => v > 0).reduce((a,b)=>a+b,0);
    const negs = plVals.filter(v => v < 0).reduce((a,b)=>a+b,0);
    const profitFactor = (profits > 0 && negs < 0) ? (profits / Math.abs(negs)) : NaN;

    // Simple max drawdown on cumulative P/L (only where P/L provided)
    let maxDD = NaN;
    if (plVals.length){
      let peak = -Infinity, cum = 0, dd = 0;
      maxDD = 0;
      for (const t of trades){
        const v = Number(t.pl);
        if (!isFinite(v)) continue;
        cum += v;
        if (cum > peak) peak = cum;
        dd = peak - cum;
        if (dd > maxDD) maxDD = dd;
      }
    }

    return { total, wins, losses, breakevens, winRate, totalPL, avgPL, avgCredit, profitFactor, maxDD };
  }

  function groupWinRate(trades, keyFn){
    const map = new Map();
    for (const t of trades){
      const k = keyFn(t);
      if (!k) continue;
      if (!map.has(k)) map.set(k, { key:k, total:0, wins:0, losses:0, breakevens:0 });
      const g = map.get(k);
      g.total++;
      if (t.result === "Win") g.wins++;
      else if (t.result === "Loss") g.losses++;
      else g.breakevens++;
    }
    const arr = Array.from(map.values()).map(g => ({
      ...g,
      winRate: g.total ? g.wins / g.total : NaN
    }));
    arr.sort((a,b) => (b.winRate - a.winRate) || (b.total - a.total));
    return arr;
  }

  // ---------------------------
  // Rendering
  // ---------------------------
  function renderStats(trades){
    const s = computeStats(trades);
    const statsGrid = document.getElementById("statsGrid");
    statsGrid.innerHTML = `
      <div class="stat"><div class="k">Total Trades</div><div class="v">${s.total}</div></div>
      <div class="stat"><div class="k">Win Rate</div><div class="v">${fmtPct(s.winRate)}</div></div>
      <div class="stat"><div class="k">Wins / Losses / BE</div><div class="v">${s.wins} / ${s.losses} / ${s.breakevens}</div></div>
      <div class="stat"><div class="k">Total P/L ($)</div><div class="v">${isFinite(s.totalPL) ? fmtNum(s.totalPL) : "—"}</div></div>
      <div class="stat"><div class="k">Avg P/L ($)</div><div class="v">${isFinite(s.avgPL) ? fmtNum(s.avgPL) : "—"}</div></div>
      <div class="stat"><div class="k">Avg Credit ($)</div><div class="v">${isFinite(s.avgCredit) ? fmtNum(s.avgCredit) : "—"}</div></div>
      <div class="stat"><div class="k">Profit Factor</div><div class="v">${isFinite(s.profitFactor) ? s.profitFactor.toFixed(2) : "—"}</div></div>
      <div class="stat"><div class="k">Max Drawdown ($)</div><div class="v">${isFinite(s.maxDD) ? fmtNum(s.maxDD) : "—"}</div></div>
    `;
  }

  function renderTable(trades, query=""){
    const q = (query||"").trim().toLowerCase();
    const filtered = !q ? trades : trades.filter(t => {
      const blob = [
        t.ticker, t.strategy, t.result, t.strikes,
        (t.tags||[]).join(" "),
        t.notes
      ].join(" ").toLowerCase();
      return blob.includes(q);
    });

    const wrap = document.getElementById("tableWrap");

    if (!filtered.length){
      wrap.innerHTML = `<div class="empty">No trades found. Add your first trade on the right.</div>`;
      return;
    }

    wrap.innerHTML = `
      <table>
        <thead>
          <tr>
            <th>Date</th>
            <th>Ticker</th>
            <th>Strategy</th>
            <th>Strike(s)</th>
            <th>Exp</th>
            <th>Credit</th>
            <th>P/L</th>
            <th>Result</th>
            <th>Tags</th>
            <th>Notes</th>
            <th>Action</th>
          </tr>
        </thead>
        <tbody>
          ${filtered.map(t => {
            const resClass = t.result === "Win" ? "good" : (t.result === "Loss" ? "bad" : "warn");
            const tags = (t.tags||[]).map(x => `<span class="tag">${escapeHtml(x)}</span>`).join(" ");
            return `
              <tr>
                <td class="small">${escapeHtml(t.entryDate || "—")}</td>
                <td><span class="tag">${escapeHtml(t.ticker)}</span></td>
                <td>${escapeHtml(t.strategy)}</td>
                <td class="small">${escapeHtml(t.strikes || "—")}</td>
                <td class="small">${escapeHtml(t.expDate || "—")}</td>
                <td class="small">${isFinite(Number(t.credit)) ? fmtNum(t.credit) : "—"}</td>
                <td class="small">${isFinite(Number(t.pl)) ? fmtNum(t.pl) : "—"}</td>
                <td class="result ${resClass}">${escapeHtml(t.result)}</td>
                <td>${tags || "—"}</td>
                <td class="small">${escapeHtml((t.notes||"").slice(0,140))}${(t.notes||"").length>140 ? "…" : ""}</td>
                <td>
                  <button class="btn-del" data-del="${t.id}" title="Delete trade" aria-label="Delete trade">✕</button>
                </td>
              </tr>
            `;
          }).join("")}
        </tbody>
      </table>
    `;

    wrap.querySelectorAll("button[data-del]").forEach(btn => {
      btn.addEventListener("click", () => {
        const id = btn.getAttribute("data-del");
        const tradesNow = loadTrades().filter(t => t.id !== id);
        saveTrades(tradesNow);
        refreshUI();
      });
    });
  }

  function renderBreakdowns(trades){
    const byStrategy = groupWinRate(trades, t => t.strategy);
    const byTicker = groupWinRate(trades, t => t.ticker);

    const sWrap = document.getElementById("byStrategy");
    const tWrap = document.getElementById("byTicker");

    sWrap.innerHTML = byStrategy.length
      ? byStrategy.slice(0,6).map(g => breakdownItem(g.key, g.winRate, g.total)).join("")
      : `<div class="empty">No data yet.</div>`;

    tWrap.innerHTML = byTicker.length
      ? byTicker.slice(0,6).map(g => breakdownItem(g.key, g.winRate, g.total)).join("")
      : `<div class="empty">No data yet.</div>`;
  }

  function breakdownItem(name, winRate, total){
    const pct = fmtPct(winRate);
    return `
      <div class="item">
        <div class="left">
          <div class="title">${escapeHtml(name)}</div>
          <div class="meta">${total} trades</div>
        </div>
        <div class="val">${pct}</div>
      </div>
    `;
  }

  function escapeHtml(str){
    return (str||"").toString()
      .replaceAll("&","&amp;")
      .replaceAll("<","&lt;")
      .replaceAll(">","&gt;")
      .replaceAll('"',"&quot;")
      .replaceAll("'","&#039;");
  }

  // ---------------------------
  // CSV Export
  // ---------------------------
  function exportCSV(trades){
    const headers = ["id","ticker","strategy","entryDate","expDate","strikes","credit","pl","result","ivr","tags","notes"];
    const rows = trades.map(t => [
      t.id, t.ticker, t.strategy, t.entryDate, t.expDate, t.strikes ?? "",
      t.credit ?? "", t.pl ?? "", t.result, t.ivr ?? "",
      (t.tags||[]).join("|"),
      (t.notes||"").replaceAll("\n"," ").trim()
    ]);

    const csv = [headers, ...rows]
      .map(r => r.map(cell => {
        const s = (cell ?? "").toString();
        const needsQuotes = /[",\n]/.test(s);
        return needsQuotes ? `"${s.replaceAll('"','""')}"` : s;
      }).join(","))
      .join("\n");

    const blob = new Blob([csv], {type:"text/csv;charset=utf-8;"});
    const url = URL.createObjectURL(blob);

    const a = document.createElement("a");
    a.href = url;
    a.download = "options-edge-trades.csv";
    document.body.appendChild(a);
    a.click();
    a.remove();
    URL.revokeObjectURL(url);
  }

  // ---------------------------
  // UI refresh
  // ---------------------------
  function refreshUI(){
    const trades = loadTrades();
    const q = document.getElementById("search").value || "";
    renderStats(trades);
    renderTable(trades, q);
    renderBreakdowns(trades);
  }

  // ---------------------------
  // Form handling
  // ---------------------------
  document.getElementById("tradeForm").addEventListener("submit", (e) => {
    e.preventDefault();

    const trade = {
      id: uid(),
      ticker: safeUpper(document.getElementById("ticker").value),
      strategy: document.getElementById("strategy").value,
      entryDate: document.getElementById("entryDate").value,
      expDate: document.getElementById("expDate").value,
      strikes: document.getElementById("strikes").value.trim(),
      result: document.getElementById("result").value,
      credit: document.getElementById("credit").value === "" ? "" : Number(document.getElementById("credit").value),
      pl: document.getElementById("pl").value === "" ? "" : Number(document.getElementById("pl").value),
      ivr: document.getElementById("ivr").value === "" ? "" : Number(document.getElementById("ivr").value),
      tags: normalizeTags(document.getElementById("tags").value),
      notes: document.getElementById("notes").value.trim(),
      createdAt: new Date().toISOString()
    };

    const trades = loadTrades();
    trades.unshift(trade);
    saveTrades(trades);

    e.target.reset();
    setDefaultDates();
    refreshUI();
  });

  document.getElementById("btnReset").addEventListener("click", () => {
    document.getElementById("tradeForm").reset();
    setDefaultDates();
  });

  document.getElementById("search").addEventListener("input", () => refreshUI());

  document.getElementById("btnClear").addEventListener("click", () => {
    if (confirm("Clear ALL trades? This cannot be undone.")){
      saveTrades([]);
      refreshUI();
    }
  });

  document.getElementById("btnExport").addEventListener("click", () => {
    const trades = loadTrades();
    if (!trades.length){
      alert("No trades to export yet.");
      return;
    }
    exportCSV(trades);
  });

  document.getElementById("btnAddSample").addEventListener("click", () => {
    const trades = loadTrades();
    if (trades.length && !confirm("Add sample trades on top of your existing trades?")) return;

    const today = new Date();
    const d = (dt) => dt.toISOString().slice(0,10);
    const plusDays = (n) => new Date(today.getTime() + n*24*60*60*1000);

    const sample = [
      { ticker:"SPY", strategy:"CSP", entryDate:d(today), expDate:d(plusDays(7)), strikes:"470p", credit:85, pl:62.5, result:"Win", ivr:42, tags:["weekly","highIV"], notes:"Sold into IV pop; closed at 70%." },
      { ticker:"TSLA", strategy:"Credit Spread", entryDate:d(plusDays(-3)), expDate:d(plusDays(4)), strikes:"240/235p", credit:120, pl:-180, result:"Loss", ivr:55, tags:["trend","aggressive"], notes:"Ignored market bias; took it anyway." },
      { ticker:"NVDA", strategy:"CC", entryDate:d(plusDays(-10)), expDate:d(plusDays(-3)), strikes:"520c", credit:95, pl:95, result:"Win", ivr:38, tags:["wheel"], notes:"Let expire worthless." },
      { ticker:"QQQ", strategy:"CSP", entryDate:d(plusDays(-6)), expDate:d(plusDays(1)), strikes:"405p", credit:70, pl:0, result:"Breakeven", ivr:47, tags:["earnings"], notes:"Closed flat to avoid event risk." }
    ].map(s => ({ ...s, id: uid(), createdAt: new Date().toISOString() }));

    saveTrades([...sample, ...trades]);
    refreshUI();
  });

  function setDefaultDates(){
    const entry = document.getElementById("entryDate");
    const exp = document.getElementById("expDate");
    const now = new Date();
    const iso = now.toISOString().slice(0,10);
    if (!entry.value) entry.value = iso;

    const plus7 = new Date(now.getTime() + 7*24*60*60*1000).toISOString().slice(0,10);
    if (!exp.value) exp.value = plus7;
  }

  // Init
  setDefaultDates();
  refreshUI();
</script>
</body>
</html>

